<div class="container mt-4" *ngIf="!isLoading">
  <h4 class="mb-3">Review Pengajuan</h4>

  <div class="row">
    <!-- Customer Info -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header bg-primary text-white">Data Customer</div>
        <div class="card-body">
          <p><strong>Nama:</strong> {{ loanRequest.customerName }}</p>
          <p><strong>Email:</strong> {{ loanRequest.customerEmail }}</p>
          <p><strong>Telepon:</strong> {{ loanRequest.customerPhone }}</p>
          <p><strong>Pekerjaan:</strong> {{ loanRequest.customerJob }}</p>
          <p><strong>Gaji Bulanan:</strong> {{ loanRequest.customerSalary | currency:'IDR' }}</p>
        </div>
      </div>
    </div>

    <!-- Loan Request Info -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header bg-success text-white">Detail Pengajuan</div>
        <div class="card-body">
          <p><strong>Jumlah:</strong> {{ loanRequest.amount | currency:'IDR' }}</p>
          <p><strong>Tenor:</strong> {{ loanRequest.tenor }} bulan</p>
          <p><strong>Status:</strong> {{ loanRequest.status }}</p>
          <p><strong>Tanggal Pengajuan:</strong> {{ loanRequest.requestDate | date }}</p>
        </div>
      </div>
    </div>
  </div>

  <form [formGroup]="reviewForm">
    <div class="mb-3">
      <label for="notes" class="form-label">Catatan</label>
      <textarea id="notes" class="form-control" formControlName="notes"></textarea>
    </div>

    <div class="d-flex gap-2">
      <!-- MARKETING -->
      <ng-container *ngIf="role === 'MARKETING'">
        <button type="button" class="btn btn-success" (click)="submitReview('DIREKOMENDASIKAN_MARKETING')"
          [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1"></span>
          Rekomendasikan
        </button>
        <button type="button" class="btn btn-danger" (click)="submitReview('DITOLAK_MARKETING')"
          [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1"></span>
          Tolak
        </button>
      </ng-container>

      <!-- BRANCH MANAGER -->
      <ng-container *ngIf="role === 'BM'">
        <button type="button" class="btn btn-success" (click)="submitReview('DISETUJUI_BM')" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1"></span>
          Setujui
        </button>
        <button type="button" class="btn btn-danger" (click)="submitReview('DITOLAK_BM')" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1"></span>
          Tolak
        </button>
      </ng-container>

      <!-- BACK OFFICE -->
      <ng-container *ngIf="role === 'BACKOFFICE'">
        <button type="button" class="btn btn-primary" (click)="submitReview('DISBURSED')" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1"></span>
          Disburse
        </button>
      </ng-container>
    </div>

  </form>

</div>